<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="utf-8">
    <title>PolyAcademy</title>
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <meta content="Free HTML Templates" name="keywords">
    <meta content="Free HTML Templates" name="description">

    <!-- Favicon -->
    <link th:href="@{/img/favicon.ico}" rel="icon">

    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.6.9/angular.min.js"></script>

    <!-- Google Web Fonts -->
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">

    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.10.0/css/all.min.css" rel="stylesheet">

    <!-- Libraries Stylesheet -->
    <link th:href="@{/lib/owlcarousel/assets/owl.carousel.min.css}" rel="stylesheet">

    <!-- Customized Bootstrap Stylesheet -->
    <link th:href="@{/css/style.css}" rel="stylesheet">
    
</head>

<body ng-app="myApp" ng-controller="myCtrl">
    <!-- Topbar Start -->
    <div class="container-fluid d-none d-lg-block">
        <div class="row align-items-center py-4 px-xl-5">
            <div class="col-lg-3">
                <a th:href="@{/courseOnline/index}" class="text-decoration-none">
                    <h1 class="m-0">
                        <span class="text-primary">Poly</span>Academy
                    </h1>
                </a>
            </div>
            <div class="col-lg-3 text-right">
                <div class="d-inline-flex align-items-center">
                    <i class="fa fa-2x fa-map-marker-alt text-primary mr-3"></i>
                    <div class="text-left">
                        <h6 class="font-weight-semi-bold mb-1">Văn phòng của chúng
                            tôi</h6>
                        <small>22 Thường Thạnh, Cái Răng, Cần Thơ</small>
                    </div>
                </div>
            </div>
            <div class="col-lg-3 text-right">
                <div class="d-inline-flex align-items-center">
                    <i class="fa fa-2x fa-envelope text-primary mr-3"></i>
                    <div class="text-left">
                        <h6 class="font-weight-semi-bold mb-1">Email của chúng tôi</h6>
                        <small>PolyAcademy@fpt.edu.vn</small>
                    </div>
                </div>
            </div>
            <div class="col-lg-3 text-right">
                <div class="d-inline-flex align-items-center">
                    <i class="fa fa-2x fa-phone text-primary mr-3"></i>
                    <div class="text-left">
                        <h6 class="font-weight-semi-bold mb-1">Gọi cho chúng tôi</h6>
                        <small>+012 345 6789</small>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- Topbar End -->
    <!-- Navbar Start -->
    <div class="container-fluid">
        <div class="row border-top px-xl-5">
            <div class="col-lg-3 d-none d-lg-block">
                <a class="d-flex align-items-center justify-content-between bg-secondary w-100 text-decoration-none"
                    data-toggle="collapse" href="#navbar-vertical" style="height: 67px; padding: 0 30px;">
                    <h5 class="text-primary m-0">
                        <i class="fa fa-book-open mr-2"></i>Danh mục khoá học
                    </h5> <i class="fa fa-angle-down text-primary"></i>
                </a>
                <nav ng-controller="DanhMuc-Ctrl"
                    class="collapse position-absolute navbar navbar-vertical navbar-light align-items-start p-0 border border-top-0 border-bottom-0 bg-light"
                    id="navbar-vertical" style="width: calc(100% - 30px); z-index: 9;">
                    <div class="navbar-nav w-100" ng-repeat="loai in danhmuc">
                        <div class="nav-item dropdown">
                            <a href="#" class="nav-link" ng-click="showLoai(loai)"
                                data-toggle="dropdown">{{loai.tenLoaiKhoaHoc}}<i
                                    class="fa fa-angle-down float-right mt-1"></i></a>

                            <div class="dropdown-menu position-absolute bg-secondary border-0 rounded-0 w-100 m-0">
                                <div ng-repeat="khoahoc in khoaHoc" style="color: black;"
                                    ng-if="khoahoc.duyet == true && khoahoc.trangThai=='false'">
                                    <a href="detail/{{khoahoc.id}}"
                                        style="width: 100%; white-space: normal; display: block; color: black;"
                                        class="dropdown-item">{{khoahoc.tenKhoaHoc}}</a>
                                </div>
                            </div>
                        </div>
                    </div>
                </nav>
            </div>
            <div class="col-lg-9">
                <nav class="navbar navbar-expand-lg bg-light navbar-light py-3 py-lg-0 px-0">
                    <a href="" class="text-decoration-none d-block d-lg-none">
                        <h1 class="m-0">
                            <span class="text-primary">Poly</span>Academy
                        </h1>
                    </a>
                    <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbarCollapse">
                        <span class="navbar-toggler-icon"></span>
                    </button>
                    <div class="collapse navbar-collapse justify-content-between" id="navbarCollapse">
                        <div class="navbar-nav py-0">
                            <a th:href="@{/courseOnline/index}" class="nav-item nav-link ">Trang
                                chủ</a> <a th:href="@{/courseOnline/course}" class="nav-item nav-link ">Khoá
                                học</a>
                            <div class="nav-item dropdown">
                                <a href="#" class="nav-link dropdown-toggle active" data-toggle="dropdown">Trang</a>
                                <div class="dropdown-menu bg-primary rounded-0 border-0 m-0">
                                    <a th:href="@{/courseOnline/contact}" class="dropdown-item">Đăng ký nhà sáng tạo</a>

                                    <a th:href="@{/courseOnline/uploademo}" class="dropdown-item active">Đăng khoá
                                        học</a>

                                </div>
                            </div>
                        </div>
                        <ul class="navbar-nav">
                            <li th:if="${session.user} == null" class="nav-item"><a class="nav-link"
                                    th:href="@{/courseOnline/dangnhap}">Đăng nhập</a></li>
                            <li th:if="${session.user} == null" class="nav-item"><a class="nav-link"
                                    th:href="@{/courseOnline/dangky}">Đăng ký</a></li>
                        </ul>
                        <div class="nav-item dropdown" th:if="${session.user != null}">
                            <input type="text" id="idLogin" hidden th:value="${session.user.id}">

                            <style>
                                /* Tùy chỉnh CSS cho menu dropdown "Tài Khoản" */
                                .dropdown-menu {
                                    position: absolute;
                                    background-color: #ff6600;
                                    /* Màu nền */
                                    border: 1px solid #ff6600;
                                    /* Viền */
                                    width: 200px;
                                    /* Độ rộng */
                                    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
                                    /* Hiệu ứng bóng đổ */
                                }

                                .dropdown-item {
                                    color: #fff;
                                    /* Màu chữ */
                                    font-size: 14px;
                                    padding: 10px 20px;
                                }
                            </style>
                            <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown"
                                style="font-size: 19px; font-weight: bold," th:text="${session.user.hoTen}"></a>
                            <div class="dropdown-menu">
                                <a th:href="@{/courseOnline/updateAccount}" class="dropdown-item">Cập nhật tài khoản</a>
                                <a th:href="@{/Admin/User}" th:if="${session.admin != null}"
                                    class="dropdown-item">Admin</a>
                                <a th:href="@{/logoff}" class="dropdown-item">Đăng xuất</a>
                            </div>
                        </div>
                    </div>
                </nav>
            </div>

        </div>
    </div>
    <!-- Navbar End -->
    <!-- Header Start -->
    <style>
        .tabs {
            display: flex;
            justify-content: center;
            /* Canh giữa các tab ngang */
            margin-bottom: 20px;
        }

        .tab-button {
            padding: 10px 110px;
            /* Điều chỉnh padding để giảm kích thước chiều ngang */
            margin: 2 5px;
            /* Thêm margin giữa các nút tab */
            cursor: pointer;
            text-align: center;
            background-color: #cca85f;
            color: #fff;
            border: none;
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        .tab-content {
            display: none;
        }

        /* Hiển thị nội dung của tab đang active */
        .tab-content.active {
            display: block;
            border: 2px solid #fff;
        }

        .active {
            display: block;
            border: 2px solid #fff;
        }

        .container {
            margin-top: 20px;
        }

        .button-container {
            margin-top: 10px;
            /* Thay đổi giá trị theo mong muốn của bạn */
        }

        /* Thêm các quy tắc CSS hiện tại của bạn ở đây */
        /* Form Section Styles */
        .video-form {
            background-color: #ffffff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            font-weight: bold;
            display: block;
            margin-bottom: 8px;
        }

        .form-control {
            width: 100%;

            border: 1px solid #ced4da;
            border-radius: 4px;
        }

        textarea.form-control {
            resize: vertical;
        }

        .btn-container {
            margin-top: 20px;
        }

        .btn {
            margin-right: 10px;
        }

        /* List Section Styles */
        .course-list {
            margin-top: 20px;
        }

        .table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }

        .table th,
        .table td {
            border: 1px solid #ddd;
            padding: 12px;
            text-align: left;
        }

        .table th {
            background-color: #ecb92d;
            color: #fff;
        }

        .table tbody tr:hover {
            background-color: #f5f5f5;
        }

        /* Common Styles */
        .container {
            margin: 0 auto;
        }

        .row {
            margin: 0 -15px;
        }

        .col-lg-6,
        .col-md-6,
        .col-sm-6,
        .col-xs-12 {
            padding: 0 15px;
        }
    </style>

    <!-- Header End -->
    <!-- Courses Start -->
    <!-- Tabs -->
    <div class="tabs">
        <button onclick="openTab('tab1')" class="tab-button active">Tạo khoá học</button>
        <button onclick="openTab('tab2')" class="tab-button">Thêm mục lục</button>
        <button onclick="openTab('tab3')" class="tab-button">Đăng video</button>
    </div>
    <!-- Tab Content -->
    <div id="tab1" class="tab-content active">
        <div class="form-group" id="authorizationTokenGroup">
            <input type="hidden" class="form-control" id="authorizationUrlInput" name="authorizationUrl"
                th:value="${authorizationUrl}">
            <!-- Đây là nút dẫn đến URL -->
            <div style="text-align: center; padding-top: 60px;">
                <a th:href="${authorizationUrl}" class="btn btn-primary">Vui lòng đăng nhập</a>
                <p>(Vui lòng đăng nhập bằng tài khoản gmail để đăng video)</p>
            </div>

            <div class="form-group" id="accessTokenGroup">
                <input type="hidden" class="form-control" id="accessToken" name="accessToken" th:value="${accessToken}">
            </div>
        </div>
        <!-- Your provided code goes here -->
        <div class="container" th:if="${accessToken != null}">
            <h1 class="text-center">Tạo Khoá Học</h1>
            <div class="row">
                <div class="col-md-12">
                    <div class="video-form">
                        <form enctype="multipart/form-data" class="dropzone dropzone-custom needsclick addcourse"
                            id="demo1-upload">
                            <div class="row">
                                <div class="col-lg-6 col-md-6 col-sm-6 col-xs-12">
                                    <div class="form-group">
                                        <input name="id" type="text" ng-model="formKhoaHoc.id" class="form-control"
                                            readonly hidden>
                                    </div>

                                    <div class="form-group">
                                        <div class="tieude">Tên khóa học:</div>
                                        <input name="tenKhoaHoc" type="text" ng-model="formKhoaHoc.tenKhoaHoc"
                                            class="form-control">
                                        <div ng-show="hassError" style="color: red;">{{message1}}</div>
                                    </div>

                                    <div class="form-group">

                                        <input name="ngayTao" id="ngayTao" type="text" ng-model="formKhoaHoc.ngayTao"
                                            hidden placeholder="NgayTao">
                                    </div>
                                    <div class="form-group">
                                        <!-- Hiển thị hình ảnh đã chọn (nếu có) -->
                                        <div id="preview">
                                            <!-- Ảnh mặc định -->
                                            <img id="defaultImage" ng-src="/Admin/img/gallery.png" alt="Default Image"
                                                height="100px" width="100px">
                                        </div>
                                        <input name="hinhAnh" id="imageInput" type="file"
                                            file-model="formKhoaHoc.hinhAnh" class="form-control"
                                            onchange="handleFileSelect()" placeholder="Hình ảnh">
                                        <div ng-show="hassError" style="color: red;">{{message3}}</div>
                                    </div>

                                </div>
                                <div class="col-lg-6 col-md-6 col-sm-6 col-xs-12">
                                    <div class="form-group">
                                        <div class="tieude">Mô tả:</div>
                                        <textarea name="moTa" ng-model="formKhoaHoc.moTa"
                                            style="width: 100%; height: 150px;"></textarea>
                                    </div>
                                </div>
                            </div>
                            <div class="container mt-4">
                                <!-- Button "Thêm" -->
                                <button id="basicSuccess" class="btn btn-success" ng-click="create()"
                                    ng-disabled="!btnThemKhoaHoc">Thêm</button>

                                <!-- Button "Sửa" -->
                                <button class="btn btn-warning mr-2" ng-click="updateKhoaHoc()"
                                    ng-disabled="!btnSuaKhoaHoc">Sửa</button>

                                <!-- Button "Xóa" -->
                                <button class="btn btn-danger" ng-click="deleteKhoaHoc(formKhoaHoc)"
                                    ng-disabled="!btnXoaKhoaHoc">Xóa</button>

                                <!-- Button "làm mới" -->
                                <button class="btn btn-info" ng-click="resetKhoaHoc()">Làm mới</button>
                            </div>
                        </form>
                    </div>
                </div>

                <script>
                    function handleFileSelect() {
                        var input = document.getElementById('imageInput');
                        var files = input.files;

                        if (files.length > 0) {
                            var file = files[0];
                            var fileType = file.type;

                            if (fileType.indexOf('image') === -1) {
                                document.getElementById('imageInput').value = '';
                                var defaultImage = document.getElementById('defaultImage');
                                defaultImage.style.display = 'block';

                                // Thay thế alert bằng SweetAlert2
                                Swal.fire({
                                    icon: 'error',
                                    title: 'Lỗi',
                                    text: 'Vui lòng chỉ chọn hình ảnh.',
                                });
                            } else {
                                var reader = new FileReader();
                                var preview = document.getElementById('preview');

                                reader.onload = function (e) {
                                    preview.innerHTML = '<img src="' + e.target.result + '" alt="Selected Image" style="height: 300px;">';
                                };

                                reader.readAsDataURL(file);
                            }
                        } else {
                            var defaultImage = document.getElementById('defaultImage');
                            defaultImage.style.display = 'block';
                        }
                    }



                </script>

                <div class="col-md-12" style="margin-top: 20px;">
                    <h4>Danh sách các khoá học đã đăng:</h4>

                    <div class="course-list">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th scope="col">Khoá học</th>
                                    <th scope="col">Mô tả</th>
                                    
                                    <th scope="col">Số người học</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr ng-repeat="khoaHoc in khoaHocFindByNguoiTao" ng-click="edit(khoaHoc)"
                                    ng-if="khoaHoc.trangThai !== 'true'">
                                    
                                    <td>{{khoaHoc.tenKhoaHoc}}</td>
                                    <td>{{khoaHoc.moTa}}</td>
                                    <td><button ng-click="editbr(khoaHoc)"><i class="fa fa-eye" aria-hidden="true"></i>Xem</button></td>
                                </tr>

                            </tbody>
                            <script>
                                function handleRowClick(idKhoaHoc) {    

                                }
                            </script>
                            <tbody>
                                <!-- Nơi hiển thị danh sách đã đăng -->
                                <tr ng-repeat="loai in khoaHocByLoai">
                                    <td>{{loai.tenKhoaHoc}}</td>
                                    <!-- Add other relevant fields here -->
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <style>
                        .course-list {
                            max-height: 300px;
                            overflow-y: auto;
                        }

                        .table {
                            width: 100%;
                        }
                    </style>
                </div>
            </div>
        </div>
    </div>

    <div id="tab2" class="tab-content">
        <div class="container" th:if="${accessToken != null}">
            <h1 class="text-center">Thêm mục lục video</h1>
            <div class="row">
                <div class="col-md-6">
                    <div class="video-form">
                        <form action="process_video.php" method="POST" enctype="multipart/form-data">
                            <div class="form-group">
                                <label for="khoaHocSelect">
                                    <h4>Chọn khoá học cần thêm mục lục</h4>
                                </label>
                                <div>
                                    <select class="form-control" id="khoaHocSelect" name="khoaHocSelect"
                                        ng-model="selectedKhoaHoc" required ng-change="changeMucLuc(selectedKhoaHoc)"
                                        ng-options="khoaHoc.id as khoaHoc.tenKhoaHoc for khoaHoc in khoaHocFindByNguoiTao">
                                    </select>

                                </div>
                            </div>
                            <div class="form-group">
                                <label for="videoTitle">
                                    <h4>Tên mục lục:</h4>
                                </label>
                                <input type="text" class="form-control" ng-model="formMucLuc.tenMucLuc" id="tenMucLuc"
                                    name="tenMucLuc" required>

                            </div>
                        </form>
                    </div>

                </div>
                <div class="col-md-6">
                    <br>
                    <div class="course-list">
                        <h4>Danh sách các khoá học đã thêm mục lục:</h4>
                        <table class="table">
                            <thead>
                                <tr>
                                    <th scope="col">Tên mục lục</th>
                                    <th>Thêm video</th>
                                </tr>
                                <tr ng-repeat="loai in mucLuc" ng-click="editMucLuc(loai)">
                                    <td>{{loai.tenMucLuc}}</td>
                                    <td> <a href="#" class="fa fa-plus" aria-hidden="true"
                                            ng-click="addNewLoai(loai)"></a>

                                    </td>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Nơi hiển thị danh sách đã đăng -->
                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="container mt-4" style="margin-bottom: 20px;">
                    <!-- Button "Thêm" -->
                    <button id="basicSuccess" class="btn btn-success" ng-click="createMucLuc()"
                        ng-disabled="!btnThemMucLuc">Thêm</button>

                    <!-- Button "Sửa" -->
                    <button class="btn btn-warning mr-2" ng-click="updateMucLuc()"
                        ng-disabled="!btnSuaMucLuc">Sửa</button>

                    <!-- Button "Xóa" -->
                    <button class="btn btn-danger" ng-click="deleteMucLuc(formMucLuc)"
                        ng-disabled="!btnXoaMucLuc">Xóa</button>

                    <!-- Button "làm mới" -->
                    <button class="btn btn-info" ng-click="resetMucLuc()">Làm mới</button>
                </div>

                <br><br>
                <style>
                    .course-list {
                        max-height: 300px;
                        /* Đặt chiều cao tối đa cho phần hiển thị */
                        overflow-y: auto;
                        /* Tạo thanh cuộn dọc khi nội dung vượt quá chiều cao tối đa */
                    }

                    .table {
                        width: 100%;
                        /* Đảm bảo bảng rộng 100% của phần chứa nó */
                    }
                </style>


                <!-- Thêm phần hiển thị danh sách khoá học sau phần đăng video -->
            </div>
        </div>
    </div>

    <div id="tab3" class="tab-content">
        <!-- Content for Tab 3 goes here -->
        <div class="container" th:if="${accessToken != null}">
            <h1 class="text-center">Đăng Video Khoá Học</h1>
            <div class="row">
                <div class="col-md-6">
                    <div class="video-form" id="uploadNewVideoSection">
                        <input type="text" ng-model="selectedTenMucLuc" hidden>
                        <form action="process_video.php" method="POST" enctype="multipart/form-data">
                            <div class="form-group" id="form-title">
                                <label for="title">Tiêu đề:</label>
                                <input type="text" class="form-control" id="title" name="title" required>
                            </div>
                            <div class="form-group" id="form-description">
                                <label for="description">Mô tả:</label>
                                <textarea class="form-control" id="description" name="description" required></textarea>
                            </div>
                            <div class="form-group" id="form-privacyStatus" hidden>
                                <label for="privacyStatus">Quyền riêng
                                    tư:</label>
                                <select class="form-control" id="privacyStatus" name="privacyStatus" required>
                                    <option value="unlisted">không công
                                        khai
                                    </option>
                                    <option value="public">Công khai
                                    </option>
                                </select>
                            </div>
                            <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12" id="form-file">
                                <div class="file-upload-inner ts-forms">
                                    <div class="input prepend-small-btn">
                                        <div class="file-button">
                                            Tải Lên
                                            <input type="file"
                                                onchange="document.getElementById('prepend-small-btn').value = this.value;"
                                                id="file" name="file" accept=".mp4">

                                        </div>
                                        <input type="text" hidden disabled id="prepend-small-btn"
                                            placeholder="Chưa có file or link nào">
                                    </div>
                                </div>
                            </div>
                            <br><br>

                            <div class="container mt-4">
                                <button class="btn btn-warning mr-2" onclick="goBack()">Quay lại</button>
                                <!-- Button "Thêm" -->
                                <button class="btn btn-primary mr-2" id="addButton">Thêm</button>


                            </div>
                        </form>
                    </div>
                </div>
                <div class="col-md-6">
                    <iframe id="videoPlayer" width="560" height="315" src="" title="YouTube video player"
                        frameborder="0"
                        allow="accelerometer; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
                        allowfullscreen></iframe>
                </div>
            </div> <!-- Thêm phần hiển thị danh sách khoá học sau phần đăng video -->
        </div>

    </div>


    <script>

        document.addEventListener("DOMContentLoaded", function () {
            const uploadNewVideoSection = document.getElementById("uploadNewVideoSection");
            const addButton = document.getElementById("addButton"); // Thêm khai báo cho addButton


            addButton.addEventListener("click", function (event) {
                // Thêm sự kiện click cho addButton
                event.preventDefault(); // Ngăn chặn hành động mặc định của nút
                if (uploadNewVideoSection.style.display !== "none") {
                    const titleInput = document.getElementById("title");
                    const descriptionInput = document.getElementById("description");
                    const privacyStatusInput = document.getElementById("privacyStatus");
                    const fileInput = document.getElementById("file");
                    if (!titleInput.value || !descriptionInput.value || !privacyStatusInput.value || !fileInput.files[0]) {
                        console.error("Vui lòng điền đầy đủ thông tin và chọn một file.");
                        return;
                    }

                    // Hiển thị loading
                    Swal.fire({
                        icon: 'info', // Biểu tượng loading
                        title: 'Đang tải lên...',
                        allowOutsideClick: false,
                        onBeforeOpen: () => {
                            Swal.showLoading();
                        }
                    });
                    const form = new FormData();

                    form.append("title", titleInput.value);
                    form.append("description", descriptionInput.value);
                    form.append("privacyStatus", privacyStatusInput.value);
                    form.append("file", fileInput.files[0]);

                    fetch("/youtube/uploadVideo", {
                        method: "POST",
                        body: form
                    })
                        .then(response => {
                            console.log(response);
                            if (response.ok) {
                                // Đóng loading và hiển thị thông báo thành công
                                Swal.fire({
                                    icon: 'success',
                                    title: 'Thành công!',
                                    text: 'Video đã được tải lên thành công.'
                                });

                                // Code AngularJS - thay thế hoặc điều chỉnh nếu cần
                                const scope = angular.element(document.querySelector('[ng-controller="myCtrl"]')).scope();
                                scope.$apply(function () {
                                    scope.createNewVideo();
                                    console.log("123352");
                                });
                            } else {
                                console.error("Đã xảy ra lỗi khi tải lên video.");
                            }
                        })
                        .catch(error => {
                            console.error("Lỗi: " + error);
                        });
                }
            });


        });

        var currentTabIndex = 1;

        function openTab(tabName) {
            var i, tabContent, tabButtons;
            tabContent = document.getElementsByClassName("tab-content");
            for (i = 0; i < tabContent.length; i++) {
                tabContent[i].style.display = "none";
            }
            tabButtons = document.getElementsByClassName("tab-button");
            for (i = 0; i < tabButtons.length; i++) {
                tabButtons[i].classList.remove("active");
                tabButtons[i].style.border = "2px solid #007bff";
                tabButtons[i].style.color = "#007bff";
            }
            document.getElementById(tabName).style.display = "block";
            var clickedButton = document.querySelector('[onclick="openTab(\'' + tabName + '\')"]');
            clickedButton.classList.add("active");
            clickedButton.style.border = "2px solid #fff";
            clickedButton.style.color = "#fff";
            currentTabIndex = parseInt(tabName.replace('tab', ''));
        }

        function goBack() {
            if (currentTabIndex > 1) {
                currentTabIndex--;
                openTab('tab' + currentTabIndex);
            } else {
                alert("This is the first tab.");
            }
        }


    </script>
    <script>
        const thumbnailInput = document.getElementById("videoThumbnail");
        const imagePreview = document.getElementById("imagePreview");
        const preview = document.getElementById("preview");
        let dateEntered = false;
        let imageDropped = false; // Thêm biến imageDropped


        function onDrop(e) {
            e.preventDefault();
            imagePreview.classList.remove("drag-over"); // Bỏ lớp khi thả xong
            const file = e.dataTransfer.files[0];
            if (file) {
                const reader = new FileReader();

                reader.onload = function (e) {
                    preview.src = e.target.result;
                };

                reader.readAsDataURL(file);

                imagePreview.style.display = "block";
                imageDropped = true; // Đặt biến imageDropped thành true khi có hình ảnh được thả vào
            } else {
                preview.src = "";
                imagePreview.style.display = "none";
            }
        }
        function onDragOver(e) {
            e.preventDefault();
            imagePreview.classList.add("drag-over"); // Thêm lớp khi kéo và thả
            dropText.style.display = "none"; // Ẩn nội dung khi kéo và thả
        }

        function onDragLeave(e) {
            e.preventDefault();
            imagePreview.classList.remove("drag-over"); // Bỏ lớp khi rời đi
            if (!imageDropped) {
                dropText.style.display = "block"; // Hiển thị nội dung khi rời đi (nếu không có hình ảnh)
            }
        }

        function onDrop(e) {
            e.preventDefault();
            imagePreview.classList.remove("drag-over"); // Bỏ lớp khi thả xong
            const file = e.dataTransfer.files[0];
            if (file) {
                const reader = new FileReader();

                reader.onload = function (e) {
                    preview.src = e.target.result;
                };

                reader.readAsDataURL(file);

                imagePreview.style.display = "block";
                imageDropped = true; // Đặt biến imageDropped thành true khi có hình ảnh được thả vào
                dropText.style.display = "none"; // Ẩn nội dung khi có hình ảnh
            } else {
                preview.src = "";
                imagePreview.style.display = "none";
            }
        }
        // Tự động nhập ngày hiện tại nếu chưa nhập
        const videoDate = document.getElementById("videoDate");
        videoDate.addEventListener("focus", function () {
            if (!dateEntered) {
                const currentDate = new Date().toLocaleDateString();
                videoDate.value = currentDate;
                dateEntered = true;
            }
        });


    </script>
    <br>
    <br>
    </div>

    <script>
        function openTab(tabName) {
            var i, tabContent, tabButtons;
            tabContent = document.getElementsByClassName("tab-content");
            for (i = 0; i < tabContent.length; i++) {
                tabContent[i].style.display = "none";
            }
            tabButtons = document.getElementsByClassName("tab-button");
            for (i = 0; i < tabButtons.length; i++) {
                tabButtons[i].classList.remove("active");
            }
            document.getElementById(tabName).style.display = "block";
            event.currentTarget.classList.add("active");
        }
    </script>



    <!-- Courses End -->
    <!-- Footer Start -->
    <div class="container-fluid bg-dark text-white py-5 px-sm-3 px-lg-5">
        <div class="row pt-5">
            <div class="col-lg-7 col-md-12">
                <div class="row">
                    <div class="col-md-6 mb-5">
                        <h5 class="text-primary text-uppercase mb-4" style="letter-spacing: 5px;">Liên hệ</h5>
                        <p>
                            <i class="fa fa-map-marker-alt mr-2"></i>22 Thường Thạnh, Khu dân
                            cư Hoàng Quân, Q. Cái Răng, TP. Cần Thơ
                        </p>
                        <p>
                            <i class="fa fa-phone-alt mr-2"></i>+012 345 67890
                        </p>
                        <p>
                            <i class="fa fa-envelope mr-2"></i>PolyAcademy@fpt.edu.vn
                        </p>
                        <div class="d-flex justify-content-start mt-4">
                            <a class="btn btn-outline-light btn-square mr-2" href="#"><i class="fab fa-twitter"></i></a>
                            <a class="btn btn-outline-light btn-square mr-2" href="#"><i
                                    class="fab fa-facebook-f"></i></a> <a class="btn btn-outline-light btn-square mr-2"
                                href="#"><i class="fab fa-linkedin-in"></i></a> <a
                                class="btn btn-outline-light btn-square" href="#"><i class="fab fa-instagram"></i></a>
                        </div>
                    </div>
                    <div class="col-md-6 mb-5">
                        <h5 class="text-primary text-uppercase mb-4" style="letter-spacing: 5px;">Khoá học của chúng tôi
                        </h5>
                        <div class="d-flex flex-column justify-content-start">
                            <a class="text-white mb-2" href="#"><i class="fa fa-angle-right mr-2"></i>Thiết kế trang
                                Web</a> <a class="text-white mb-2" href="#"><i class="fa fa-angle-right mr-2"></i>Phát
                                triển phần mềm</a> <a class="text-white mb-2" href="#"><i
                                    class="fa fa-angle-right mr-2"></i>Kỹ năng học tập</a> <a class="text-white mb-2"
                                href="#"><i class="fa fa-angle-right mr-2"></i>Pháp luật</a> <a class="text-white"
                                href="#"><i class="fa fa-angle-right mr-2"></i>Tiếng Anh</a>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-lg-5 col-md-12 mb-5">
                <h5 class="text-primary text-uppercase mb-4" style="letter-spacing: 5px;">PolyAcademy</h5>
                <p>PolyAcademy - Nền tảng lớp học trực tuyến hàng đầu, cung cấp
                    giải pháp giáo dục toàn diện ngoài trường học cho tất cả học sinh,
                    sinh viên trên cả nước với chất lượng tốt nhất!</p>
                <div class="w-100">
                    <div class="input-group">
                        <input type="text" class="form-control border-light" style="padding: 30px;"
                            placeholder="Hãy gửi Email cho chúng tôi">
                        <div class="input-group-append">
                            <button class="btn btn-primary px-4">Đăng ký</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script>
        const fileInput = document.getElementById("file");

        fileInput.addEventListener("change", function () {
            const selectedFile = fileInput.files[0];

            if (selectedFile) {
                if (selectedFile.type === "video/mp4") {
                    const objectURL = URL.createObjectURL(selectedFile);
                    videoPlayer.src = objectURL;
                    youtubeVideoContainer.style.display = "none";
                } else {
                    fileInput.value = "";
                }
            } else {
                videoPlayer.src = "";
            }
        });
    </script>
    
    <style>
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgb(0, 0, 0);
            background-color: rgba(0, 0, 0, 0.4);
            padding-top: 60px;
            align-items: center;
        }

        .modal-content {
            background-color: #fffcfc;
            margin: 5% auto;
            padding: 20px;
            border: 1px solid #888;
            width: 80%;
        }

        .close {
            color: #323030;
            float: right;
            font-size: 28px;
            font-weight: bold;
        }

        .close:hover,
        .close:focus {
            color: black;
            text-decoration: none;
            cursor: pointer;
        }
    </style>
    <div id="myModal" class="modal">
        <div class="modal-content">
            <!-- Nội dung của modal ở đây -->
            <span class="close" ng-click="closeModal()">&times;</span>
            <h2>{{ modalItem.tenKhoaHoc }}</h2>
            <div class="traffice-source-area mg-b-30">
                <div class="container-fluid">
                    <div class="row">
                        <div class="col-lg-3 col-md-6 col-sm-6 col-xs-12">
                            <div class="white-box analytics-info-cs">
                                <h3 class="box-title" style="font-size: 18px;">Tổng Doanh Thu</h3>
                                <ul class="list-inline  ">
                                    <li>
                                        <div id="sparklinedash"></div>
                                    </li>
                                    <li class="text-right sp-cn-r" style="width: 50%;"><i class="fa fa-level-up"
                                            aria-hidden="true"></i>
                                        <span class="counter text-success"><span class="counter">{{
                                                formatCurrency(totalRevenue2)}}</span></span>
                                    </li>
                                </ul>
                            </div>
                        </div>

                        <div class="col-lg-3 col-md-6 col-sm-6 col-xs-12">
                            <div class="white-box analytics-info-cs">
                                <h3 class="box-title" style="font-size: 18px;">Số người học</h3>
                                <ul class="list-inline  ">
                                    <li>
                                        <div id="sparklinedash"></div>
                                    </li>
                                    <li class="text-right sp-cn-r" style="width: 40%;"><i class="fa fa-level-up"
                                            aria-hidden="true"></i>
                                        <span class="counter text-success"><span
                                                class="counter">{{SoNguoi}}</span></span>
                                    </li>
                                </ul>
                            </div>
                        </div>

                        <style>
                            .custom-form {
                                display: flex;
                                flex-direction: column;
                                max-width: 300px;
                                margin: 0 auto;
                            }

                            .form-group {
                                margin-bottom: 15px;
                            }

                            label {
                                margin-bottom: 5px;
                                display: block;
                            }

                            input[type="date"],
                            button {
                                padding: 8px;
                                font-size: 16px;
                                border-radius: 5px;
                                border: 1px solid #ccc;
                            }

                            button {
                                cursor: pointer;
                                background-color: #28a745;
                                color: #fff;
                                border: none;
                                transition: background-color 0.3s ease;
                            }

                            button:hover {
                                background-color: #218838;
                            }
                        </style>
                        
                    </div>
                </div>
            </div>
           
            <!-- Main content -->

            <!-- Thêm các trường dữ liệu khác bạn muốn hiển thị -->
        </div>
    </div>
    <script>

        var app = angular.module('myApp', []);
        app.controller('myCtrl', function ($scope, $http, $window) {
            $scope.khoaHocByLoai = {};
            $scope.khoaHoc = {};
            $scope.formKhoaHoc = {};
            $scope.khoaHocFindByNguoiTao = {};
            $scope.mucLuc = {};
            $scope.selectedKhoaHoc = {}; // Initialize selectedKhoaHoc object
            $scope.mucLucDaChon = {};
            $scope.thoigiankhoahoc = {};
            $scope.itemsThongKeTheoKhoaHoc = [];
            $scope.modalItem = {};
            $scope.formVideo = {};
            //định dạng tiền
            $scope.formatCurrency = function (amount) {
                // Chuyển đổi số tiền thành chuỗi và loại bỏ số 0 ở cuối
                return numeral(amount).format('0,0') + ' VND';
            };
            $scope.ThongKeNguoiHoc = function (id) {
                $http.get(apiEndpoints.ThongKeNguoiHoc, {
                    params: {
                        idKhoaHoc: id
                    }
                }).then(resp => {
                    $scope.SoNguoi = resp.data;
                });
                return $scope.SoNguoi;
            }
            $scope.ThongKeTheoKhoaHoc = function () {

                $scope.convertToMoment2();

                //Thông kê số người học theo mốc thời gian
                $http.get(apiEndpoints.ThongKeNguoiHocTG, {
                    params: {
                        idKhoaHoc: $scope.modalItem.id,
                        batDau: $scope.thoigiankhoahoc.batDau,
                        ketThuc: $scope.thoigiankhoahoc.ketThuc
                    }
                }).then(resp => {
                    $scope.SoNguoi = resp.data;
                });

                $http.get(apiEndpoints.ThongKeKhoaHocTG, {
                    params: {
                        idKhoaHoc: $scope.modalItem.id,
                        batDau: $scope.thoigiankhoahoc.batDau,
                        ketThuc: $scope.thoigiankhoahoc.ketThuc
                    }
                }).then(resp => {
                    $scope.itemsThongKeTheoKhoaHoc = resp.data;

                    // Extract data for chart
                    const labels = $scope.itemsThongKeTheoKhoaHoc.map(item => $scope.formatDate(item.year, item.month));
                    const data = $scope.itemsThongKeTheoKhoaHoc.map(item => item.totalRevenue);
                    // Tính tổng doanh thu
                    $scope.totalRevenue2 = $scope.itemsThongKeTheoKhoaHoc.reduce((total, item) => total + item.totalRevenue, 0);
                    // Get the canvas element
                    const canvas = document.getElementById("revenue-chart2");
                    if ($scope.myChart2) {
                        $scope.myChart2.destroy();
                    }
                    // Create the chart using Chart.js
                    const ctx = canvas.getContext("2d");
                    $scope.myChart2 = new Chart(ctx, {
                        type: "bar",
                        data: {
                            labels: labels,
                            datasets: [{
                                label: "Tổng doanh thu/tháng",
                                data: data,
                                backgroundColor: "rgba(75, 192, 192, 0.2)",
                                borderColor: "rgba(75, 192, 192, 1)",
                                borderWidth: 1
                            }]
                        },
                        options: {
                            scales: {
                                y: {
                                    beginAtZero: true,
                                    ticks: {
                                        callback: function (value, index, values) {
                                            return $scope.formatTotalPrice(value);
                                        }
                                    }
                                }
                            }
                        }
                    });

                });


            };
            $scope.xoaformthongke = function () {
                $scope.itemsThongKeTheoKhoaHoc = [];

            }

            $scope.editbr = function (item) {
                $scope.formatTotalPrice = function (totalPrice) {
                    return numeral(totalPrice).format('0,0') + ' VND';
                };

                $scope.formatDate = function (year, month) {
                    const date = moment(`${year}-${month}`, 'YYYY-M').format('MM YYYY');
                    return date.charAt(0).toUpperCase() + date.slice(1);
                };
                $scope.modalItem = angular.copy(item);

                $scope.openModal();
                $scope.ThongKeNguoiHoc($scope.modalItem.id);

                $http.get(apiEndpoints.ThongKeKhoaHoc, {
                    params: {
                        idKhoaHoc: $scope.modalItem.id,
                    }
                }).then(resp => {
                    $scope.itemsThongKeTheoKhoaHoc = resp.data;

                    // Extract data for chart
                    const labels = $scope.itemsThongKeTheoKhoaHoc.map(item => $scope.formatDate(item.year, item.month));
                    const data = $scope.itemsThongKeTheoKhoaHoc.map(item => item.totalRevenue);
                    // Tính tổng doanh thu
                    $scope.totalRevenue2 = $scope.itemsThongKeTheoKhoaHoc.reduce((total, item) => total + item.totalRevenue, 0);

                    // Get the canvas element
                    const canvas = document.getElementById("revenue-chart2");

                    // Create the chart using Chart.js
                    const ctx = canvas.getContext("2d");
                    $scope.myChart2 = new Chart(ctx, {
                        type: "bar",
                        data: {
                            labels: labels,
                            datasets: [{
                                label: "Tổng doanh thu/tháng",
                                data: data,
                                backgroundColor: "rgba(75, 192, 192, 0.2)",
                                borderColor: "rgba(75, 192, 192, 1)",
                                borderWidth: 1
                            }]
                        },
                        options: {
                            scales: {
                                y: {
                                    beginAtZero: true,
                                    ticks: {
                                        callback: function (value, index, values) {
                                            return $scope.formatTotalPrice(value);
                                        }
                                    }
                                }
                            }
                        }
                    });

                });


            };
            $scope.openModal = function () {
                document.getElementById('myModal').style.display = 'block';
            };
            $scope.closeModal = function () {
                $scope.xoaformthongke();
                document.getElementById('myModal').style.display = 'none';
            };
            $scope.convertToMoment2 = function () {

                $scope.thoigiankhoahoc.batDau = moment($scope.thoigiankhoahoc.batDau).toDate();
                $scope.thoigiankhoahoc.ketThuc = moment($scope.thoigiankhoahoc.ketThuc).toDate();

            }
            var apiEndpoints = {
                report: "/rest/Report",
                thongKeThoiGian: "/rest/Report/thong-ke-thoi-gian",
                ThongKeKhoaHoc: "/rest/Report/thong-ke-Khoa-hoc",
                ThongKeKhoaHocTG: "/rest/Report/thong-ke-Khoa-hoc-TG",
                ThongKeNguoiHoc: "/rest/Report/thong-ke-nguoi-hoc",
                ThongKeNguoiHocTG: "/rest/Report/thong-ke-nguoi-hoc-theo-moc-thoi-gian",
                ThongKeTheoNgay: "/rest/Report/thong-ke-theo-ngay",
                ThongKeThangNay: "/rest/Report/thong-ke-thang-nay",
                ThongKeNamNay: "/rest/Report/thong-ke-nam-nay",
                ThongKeNamTruoc: "/rest/Report/thong-ke-nam-truoc",
            };
            
            $scope.changeLoai = function (id) {
                // Thêm logic xử lý khi giá trị thay đổi
                $http.get('/api/khoahoc/byLoai/' + id)
                    .then(function (response) {

                    })
            }
            $scope.changeKhoaHoc = function (id) {
                $http.get('/api/khoahoc/' + id)
                    .then(function (response) {
                        $scope.khoaHoc = response.data;
                        $scope.khoaHocByLoai = response.data;
                    })
            }

            $scope.changeMucLuc = function (id) {
                $http.get('/rest/admin/MucLuc/KhoaHoc/' + id)
                    .then(function (response) {
                        $scope.mucLuc = response.data;
                    })
            }

            const authorizationTokenGroup = document.getElementById('authorizationTokenGroup');
            const accountTokenInput = document.getElementById("accessToken");

            $scope.updateUI = function () {
                if (accountTokenInput === null || accountTokenInput.value === '' || accountTokenInput.value === null) {
                    authorizationTokenGroup.style.display = 'block';
                } else {
                    authorizationTokenGroup.style.display = 'none';
                }
                $scope.idLogin = document.getElementById("idLogin").value;
                $http.get('/api/khoahoc')
                    .then(response => {
                        $scope.khoaHoc = response.data;
                        $scope.khoaHocFindByNguoiTao = $scope.khoaHoc.filter(item => item.nguoiTao.id == $scope.idLogin);
                        
                        
                    })
                    .catch(error => {
                        // Xử lý lỗi nếu cần
                        console.error('Lỗi khi lấy dữ liệu khóa học:', error);
                    });
                $scope.btnThemKhoaHoc = true;
                $scope.btnSuaKhoaHoc = false;
                $scope.btnXoaKhoaHoc = false;

                $scope.btnThemMucLuc = true;
                $scope.btnSuaMucLuc = false;
                $scope.btnXoaMucLuc = false;
            };
            $scope.edit = function (item) {
                $scope.formKhoaHoc = angular.copy(item); // Copy khoaHoc object to selectedKhoaHoc
                $scope.btnThemKhoaHoc = false;
                $scope.btnSuaKhoaHoc = true;
                $scope.btnXoaKhoaHoc = true;
            }
            $scope.editMucLuc = function (item) {
                $scope.formMucLuc = angular.copy(item); // Copy khoaHoc object to selectedKhoaHoc
                $scope.btnThemMucLuc = false;
                $scope.btnSuaMucLuc = true;
                $scope.btnXoaMucLuc = true;
            }
            $scope.updateKhoaHoc = function () {
                $scope.hassError = false;
                var input = document.getElementById('imageInput');
                var files = input.files;
                var item = angular.copy($scope.formKhoaHoc);
                // Chuyển đổi định dạng của chuỗi ngày tháng
                var currentDate = new Date();
                $scope.formKhoaHoc.ngayTao = currentDate.toISOString();
                var formData = new FormData();
                if (files[0] != null) {
                    $scope.formKhoaHoc.hinhAnh = files[0];
                    var formData = new FormData();
                    formData.append('hinhAnh', $scope.formKhoaHoc.hinhAnh);
                } else {
                    $scope.formKhoaHoc.hinhAnh = $scope.formKhoaHoc.hinhAnh;
                    formData.append('hinhAnh', $scope.formKhoaHoc.hinhAnh);

                }
                formData.append('khoaHoc', new Blob([JSON.stringify($scope.formKhoaHoc)], { type: "application/json" }));

                $http.put(`/rest/admin/KhoaHoc/${item.id}`, formData, {
                    transformRequest: angular.identity,
                    headers: { 'Content-Type': undefined }
                })
                    .then(function (response) {
                        // Thành công
                        $scope.showSuccessMessage('Thành công!', 'Cập nhật thành công');
                        $scope.updateUI();
                        $scope.resetKhoaHoc();
                    })
                    .catch(function (error) {
                        // Lỗi
                        $scope.showFailureMessage('Lỗi!', 'Đã xảy ra lỗi khi cập nhật dữ liệu.');
                    });


            }
            $scope.addNewLoai = function (loai) {
                // Tạo một loại mới với thông tin từ loai được truyền vào
                console.log(loai)
                var newLoai = {
                    tenMucLuc: loai.tenMucLuc, // Sử dụng thông tin từ loai được truyền vào
                    // Các thông tin khác về loại mới có thể được thêm ở đây
                };

                // Thêm loại mới vào mảng mucLuc
                $scope.selectedTenMucLuc = loai.id;


                // Gọi hàm openTab với thông tin của loại mới
                openTab('tab3');
            };
            $scope.updateMucLuc = function () {
                $http.put(`/rest/admin/MucLuc/${$scope.formMucLuc.id}`, $scope.formMucLuc)
                    .then(resp => {
                        // Thành công
                        $scope.showSuccessMessage('Thành công!', 'Cập nhật Mục lục thành công');
                        $scope.resetMucLuc();
                        $scope.updateUI();
                        $scope.changeMucLuc($scope.selectedKhoaHoc);
                    })
                    .catch(error => {
                        // Lỗi
                        $scope.showFailureMessage('Lỗi!', 'Đã xảy ra lỗi khi cập nhật Mức lực.');
                        console.log("Error", error);
                    });
            };

            // Xóa 
            $scope.deleteKhoaHoc = function (item) {
                // Sử dụng SweetAlert để hiển thị cảnh báo xác nhận
                Swal.fire({
                    title: 'Bạn chắc chắn muốn xóa?',
                    text: 'Hành động này sẽ xóa Khóa học!',
                    icon: 'warning',
                    showCancelButton: true,
                    confirmButtonText: 'Đồng ý',
                    cancelButtonText: 'Hủy bỏ'
                }).then((result) => {
                    if (result.isConfirmed) {
                        // Nếu người dùng nhấn Đồng ý, thực hiện xóa
                        $scope.hassError = false;
                        $scope.formKhoaHoc.trangThai = true;

                        var itemCopy = angular.copy($scope.formKhoaHoc);
                        // Chuyển đổi định dạng của chuỗi ngày tháng
                        var currentDate = new Date();
                        $scope.formKhoaHoc.ngayTao = currentDate.toISOString();
                        var formData = new FormData();
                        formData.append('hinhAnh', new Blob([JSON.stringify($scope.formKhoaHoc.hinhAnh)], { type: "application/json" }));
                        formData.append('khoaHoc', new Blob([JSON.stringify($scope.formKhoaHoc)], { type: "application/json" }));

                        $http.put(`/rest/admin/KhoaHoc/${itemCopy.id}`, formData, {
                            transformRequest: angular.identity,
                            headers: { 'Content-Type': undefined }
                        })
                            .then(function (response) {
                                // Hiển thị thông báo thành công
                                Swal.fire(
                                    'Thành công!',
                                    'Khóa học đã được xóa thành công.',
                                    'success'
                                );
                                $scope.updateUI();
                                $scope.resetKhoaHoc();
                            })
                            .catch(function (error) {
                                // Hiển thị thông báo lỗi
                                Swal.fire(
                                    'Lỗi!',
                                    'Đã xảy ra lỗi khi xóa Khóa học.',
                                    'error'
                                );
                                console.log("Error", error);
                            });
                    }
                });
            };


            $scope.deleteMucLuc = function (item) {
                // Sử dụng SweetAlert để hiển thị cảnh báo xác nhận
                Swal.fire({
                    title: 'Bạn chắc chắn muốn xóa?',
                    text: 'Hành động này sẽ xóa Mục lục!',
                    icon: 'warning',
                    showCancelButton: true,
                    confirmButtonText: 'Đồng ý',
                    cancelButtonText: 'Hủy bỏ'
                }).then((result) => {
                    if (result.isConfirmed) {
                        // Nếu người dùng nhấn Đồng ý, thực hiện xóa
                        $http.delete(`/rest/admin/MucLuc/${item.id}`)
                            .then(resp => {
                                // Hiển thị thông báo thành công
                                Swal.fire(
                                    'Thành công!',
                                    'Mục lục đã được xóa thành công.',
                                    'success'
                                );
                                $scope.resetMucLuc();
                                $scope.updateUI();
                                $scope.changeMucLuc($scope.selectedKhoaHoc);
                            })
                            .catch(error => {
                                // Hiển thị thông báo lỗi
                                Swal.fire(
                                    'Lỗi!',
                                    'Đã xảy ra lỗi khi xóa Mức lực.',
                                    'error'
                                );
                                console.log("Error", error);
                            });
                    }
                });
            };


            $scope.resetKhoaHoc = function () {
                $scope.formKhoaHoc = {};
                // Xóa giá trị của input file
                var input = document.getElementById('imageInput');
                input.value = '';
                // Xóa nội dung của phần tử preview
                var preview = document.getElementById('preview');
                preview.innerHTML = '';

                // Hiển thị ảnh mặc định
                var preview = document.getElementById('preview');
                preview.innerHTML = '<img  src="/Admin/img/gallery.png" alt="Default Image" height="100px" width="100px">';

                $scope.btnThemKhoaHoc = true;
                $scope.btnSuaKhoaHoc = false;
                $scope.btnXoaKhoaHoc = false;
            }

            $scope.resetMucLuc = function () {
                $scope.formMucLuc = {};
                $scope.btnThemMucLuc = true;
                $scope.btnSuaMucLuc = false;
                $scope.btnXoaMucLuc = false;
            }
            // Hàm hiển thị thông báo thành công
            $scope.showSuccessMessage = function (title, message) {
                Swal.fire({
                    icon: 'success',
                    title: title,
                    text: message,
                    confirmButtonText: 'Đóng',
                });
            };

            // Hàm hiển thị thông báo lỗi
            $scope.showFailureMessage = function (title, message) {
                Swal.fire({
                    icon: 'error',
                    title: title,
                    text: message,
                    confirmButtonText: 'Đóng',
                });
            };
            $scope.create = function () {
                $scope.idLogin = document.getElementById("idLogin").value;
                $scope.hassError = false;
                //trạng thái hiển thị khoa học
                $scope.formKhoaHoc.trangThai = "false";
                $scope.formKhoaHoc.duyet = false;
                var input = document.getElementById('imageInput');
                var files = input.files;

                var currentDate = new Date();
                $scope.formKhoaHoc.ngayTao = currentDate.toISOString();
                $scope.formKhoaHoc.hinhAnh = files[0];
                $scope.formKhoaHoc.nguoiTao = { id: $scope.idLogin };
                $scope.formKhoaHoc.loaiKhoaHoc = { id: '6' };
                var formData = new FormData();
                formData.append('hinhAnh', $scope.formKhoaHoc.hinhAnh);
                $scope.formKhoaHoc.hinhAnh = files[0].name;

                formData.append('khoaHoc', new Blob([JSON.stringify($scope.formKhoaHoc)], { type: "application/json" }));
                $http.post('/api/khoahoc', formData, {
                    transformRequest: angular.identity,
                    headers: { 'Content-Type': undefined }
                })
                    .then(function (response) {
                        // Thành công
                        $scope.showSuccessMessage('Thành công!', 'Thêm thành công');
                        $scope.updateUI();
                        $scope.resetKhoaHoc();
                    })
                    .catch(function (error) {
                        // Lỗi
                        $scope.showFailureMessage('Lỗi!', 'Đã xảy ra lỗi khi thêm dữ liệu.');
                    });

            }
            function getCookieValue(cookieName) {
                const cookies = document.cookie.split(';');
                for (let i = 0; i < cookies.length; i++) {
                    const cookie = cookies[i].trim();
                    if (cookie.startsWith(cookieName + '=')) {
                        console.log(cookie.substring(cookieName.length + 1));
                        return cookie.substring(cookieName.length + 1);
                    }
                }
                return null;
            }

            function deleteCookie(cookieName) {
                const cookies = document.cookie.split(';');
                for (let i = 0; i < cookies.length; i++) {
                    const cookie = cookies[i].trim();
                    if (cookie.startsWith(cookieName + '=')) {
                        const cookieParts = cookie.split('=');
                        const name = cookieParts[0];
                        // Đặt thời gian hết hạn của cookie thành ngày quá khứ
                        document.cookie = name + '=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;';
                        return;
                    }
                }
            }
            $scope.createMucLuc = function () {
                $scope.hassError = false;
                $scope.idLogin = document.getElementById("idLogin").value;
                $http.get('/api/khoahoc/' + $scope.selectedKhoaHoc)
                    .then(function (response) {
                        $scope.formMucLuc.khoaHoc = response.data;
                        $scope.formMucLuc.nguoiTao = { id: $scope.idLogin };
                        $scope.formMucLuc.ngayTao = new Date().toISOString();
                        var item = angular.copy($scope.formMucLuc);
                        $http.post('/rest/admin/MucLuc', item)
                            .then(function (response) {
                                // Thành công
                                $scope.showSuccessMessage('Thành công!', 'Thêm Mục lục mới thành công');
                                $scope.updateUI();
                                $scope.resetMucLuc();
                                $scope.changeMucLuc($scope.selectedKhoaHoc);
                            })
                            .catch(function (response) {
                                // Lỗi
                                $scope.showFailureMessage('Lỗi!', 'Đã xảy ra lỗi khi thêm Mức lực mới.');
                                $scope.hassError = true;
                                $scope.message1 = "Tên khoá học đã tồn tại";
                                console.log(response);
                            });
                    });
            };


            $scope.createNewVideo = function () {
                const selectedCourseId = $scope.selectedTenMucLuc;
                console.log(selectedCourseId)
                if (!selectedCourseId) {
                    return;
                }

                const usernameCookie = getCookieValue('videoId');
                // Lấy đối tượng input theo id "title"
                var inputElement = document.getElementById("title");
                console.log(inputElement)
                var videoTitle;
                // Lấy giá trị từ input khi người dùng nhấn nút "Lấy giá trị"
                videoTitle = inputElement.value;

                console.log(usernameCookie);
                console.log(videoTitle);

                $http.get("/rest/admin/MucLuc/" + $scope.selectedTenMucLuc)
                    .then(resp => {
                        $scope.formVideo.mucLuc = resp.data;

                        $http.get("/rest/admin/NguoiDung/" + 1)
                            .then(resp => {
                                $scope.formVideo.nguoiTao = resp.data;
                                $scope.formVideo.linkVideo = usernameCookie;
                                $scope.formVideo.tenVideo = videoTitle;
                                $scope.formVideo.thuTu = $scope.order + 1;

                                // Lấy ngày và giờ hiện tại
                                var currentDate = new Date();
                                $scope.formVideo.ngayTao = currentDate.toISOString(); // Lưu dưới dạng ISO string

                                deleteCookie('videoId');
                                deleteCookie('videoTitle');


                                // Gửi yêu cầu POST để thêm video mới
                                console.log($scope.formVideo);

                                $http.post(`/rest/admin/Videos`, $scope.formVideo)
                                    .then(resp => {
                                        // Xử lý kết quả thành công nếu cần thiết
                                        console.log(resp)
                                    })
                                    .catch(error => {
                                        console.log("Error", error);
                                    });

                            })
                            .catch(error => {
                                console.log("Error", error);
                            });
                    })
                    .catch(error => {
                        console.log("Error", error);
                    });
            };

            $scope.updateUI();
   
        });
    </script>

    <!-- Footer End -->
    <!-- Back to Top -->
    <a href="#" class="btn btn-lg btn-primary btn-lg-square back-to-top"><i class="fa fa-angle-double-up"></i></a>
    <!-- JavaScript Libraries -->
    <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.bundle.min.js"></script>

    <!-- Thêm thư viện SweetAlert -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <!-- Template Javascript -->
    <script th:src="@{/js/main.js}"></script>

    <script th:src="@{/js/loai.js}"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/numeral.js/2.0.6/numeral.min.js"></script>
    <script th:src="@{https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js}"></script>
    <script>
        $(document).ready(function () {
            $("#toggleDateInputs").click(function () {
                $(".date-inputs").toggle();
                $("#arrowIcon").toggleClass("fa-chevron-down fa-chevron-up");
            });
            $("#toggleDateInputs2").click(function () {
                $(".date-inputs2").toggle();
                $("#arrowIcon2").toggleClass("fa-chevron-down fa-chevron-up");
            });
        });
    </script>

</body>

</html>